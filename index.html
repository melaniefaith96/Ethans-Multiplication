<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beat Multiply</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  color: #f0f0f0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  flex-direction: column;
  transition: background-color 0.3s;
  user-select: none;
  overflow: hidden;
  position: relative;
  background: linear-gradient(135deg, #2c3e50, #3498db);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
}
@keyframes gradientBG {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* Star styles */
#stars { 
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  z-index:0;
}
.star {
  position: absolute;
  width: 2px;
  height: 2px;
  background: white;
  border-radius: 50%;
  opacity: 0;
  animation: twinkle 2s infinite ease-in-out, drift linear infinite;
}
@keyframes twinkle {
  0%,100%{opacity:0.2;}
  50%{opacity:1;}
}
@keyframes drift {
  0% {transform: translateY(0);}
  100% {transform: translateY(-110vh);}
}

/* Game elements */
#startScreen { text-align:center; margin-bottom:20px; z-index:10; }
#countdown {
  font-size: 4em;
  margin-top:20px;
  animation: pulse 1s infinite;
  color:#b2e0ff;
  text-shadow:0 0 8px #7fbfff;
  z-index:10;
}
@keyframes pulse {0%,100%{opacity:1;}50%{opacity:0.3;}}
.question { font-size:2em; margin-bottom:20px; text-shadow:0 0 6px #0d1f3f; z-index:10; }
.answer-input {
  padding:10px; font-size:1.5em; width:100px; text-align:center;
  border-radius:6px; border:none; outline:none; box-shadow:0 0 8px rgba(255 255 255 / 0.3); z-index:10;
}
.answer-input:focus { box-shadow:0 0 12px #a4d2ff; background:#d6eaff; color:#003366; font-weight:bold; }
.feedback {
  margin-top:15px; font-size:1.5em; height:1.5em; min-height:1.5em;
  transition: transform 0.3s ease; user-select:none; text-shadow:0 0 4px #000000a0; z-index:10;
}
.feedback.correct { color:#a3ffae; animation: popScale 0.4s ease forwards; text-shadow:0 0 10px #2ad04a; }
.feedback.wrong { color:#ff7f7f; animation: shake 0.4s ease; text-shadow:0 0 10px #d02020; }
@keyframes popScale {0%{transform:scale(0.8); opacity:0;}100%{transform:scale(1); opacity:1;}}
@keyframes shake {0%,100%{transform:translateX(0);}20%,60%{transform:translateX(-8px);}40%,80%{transform:translateX(8px);}}
.score { margin-top:20px; font-weight:bold; text-shadow:0 0 8px #0d1f3f; z-index:10; }
.flash-correct { animation: flashGreen 0.4s alternate 4; }
.flash-wrong { animation: flashRed 0.3s alternate 4; }
@keyframes flashGreen {0%{background-color:#2c3e50;}100%{background-color:#2ecc71;}}
@keyframes flashRed {0%{background-color:#2c3e50;}100%{background-color:#e74c3c;}}
button {
  padding:12px 24px; font-size:1.2em; cursor:pointer;
  background:#2980b9; color:white; border:none; border-radius:8px; box-shadow:0 0 10px #2980b9;
  transition:background 0.3s, transform 0.2s; user-select:none; margin:0 10px; z-index:10;
}
button:hover{background:#1c5980; transform:scale(1.05);}
button:active{transform:scale(0.95);}
#buttonContainer{margin-bottom:20px;}
#confetti{pointer-events:none; position:fixed; top:0;left:0;right:0;bottom:0; width:100vw;height:100vh; overflow:visible; z-index:9999;}
.confetti-piece{position:absolute;width:10px;height:10px;background-color:red;opacity:0.9;will-change:transform,opacity;border-radius:2px;}
#celebration-text{
  position: fixed; top:40%; left:50%; transform:translate(-50%, -50%);
  font-size:5em; font-weight:bold; color: yellow; text-shadow:0 0 20px #ff0000;
  display:none; z-index:10000; animation: flashText 0.5s alternate 10;
}
@keyframes flashText{0%{opacity:0;}100%{opacity:1;}}
</style>
</head>
<body>
<div id="stars"></div>
<div id="startScreen">
  <div id="buttonContainer">
    <button id="startBtn">Start Game</button>
    <button id="stopBtn">Stop Music</button>
  </div>
  <div id="countdown" style="display:none;"></div>
</div>
<div class="question" id="question" style="display:none;"></div>
<input type="number" id="answer" class="answer-input" placeholder="?" autofocus style="display:none;" />
<div class="feedback" id="feedback"></div>
<div class="score" id="score" style="display:none;">Score: 0</div>
<div id="confetti"></div>
<div id="celebration-text">YOU DID IT!</div>

<audio id="beat" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop hidden></audio>
<audio id="correctSound" src="https://freesound.org/data/previews/170/170664_2437358-lq.mp3" preload="auto"></audio>
<audio id="celebrationSound" src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3" preload="auto"></audio>

<script>
// Generate stars
const starsContainer = document.getElementById('stars');
for(let i=0;i<100;i++){
  const star = document.createElement('div');
  star.classList.add('star');
  star.style.left = Math.random()*100 + "vw";
  star.style.top = Math.random()*100 + "vh";
  star.style.width = star.style.height = Math.random()*2+1 + "px";
  star.style.animationDuration = (5 + Math.random()*5) + "s, " + (8 + Math.random()*10) + "s"; // twinkle, drift
  starsContainer.appendChild(star);
}

const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const countdownEl = document.getElementById('countdown');
const startScreen = document.getElementById('startScreen');
const questionEl = document.getElementById('question');
const answerEl = document.getElementById('answer');
const feedbackEl = document.getElementById('feedback');
const scoreEl = document.getElementById('score');
const beat = document.getElementById('beat');
const correctSound = document.getElementById('correctSound');
const celebrationSound = document.getElementById('celebrationSound');
const confettiContainer = document.getElementById('confetti');
const celebrationText = document.getElementById('celebration-text');

let num1,num2,correctAnswer,score=0,feedbackTimeout;
const messages = ["Way to go!","Almost there!","Keep going!","You can do this, Ethan!"];

function generateQuestion(){
  num1=Math.floor(Math.random()*12)+1;
  num2=Math.floor(Math.random()*12)+1;
  correctAnswer=num1*num2;
  questionEl.textContent=`${num1} × ${num2} = ?`;
  answerEl.value='';
  feedbackEl.textContent='';
  feedbackEl.className='feedback';
  answerEl.focus();
}

function celebrateConfetti(count=150){
  const colors=['#f94144','#f3722c','#f9c74f','#90be6d','#577590','#43aa8b','#f9844a'];
  for(let i=0;i<count;i++){
    const confetti=document.createElement('div');
    confetti.classList.add('confetti-piece');
    confetti.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
    confetti.style.left=Math.random()*window.innerWidth+'px';
    confetti.style.top='-10px';
    confetti.style.width=(5+Math.random()*8)+'px';
    confetti.style.height=(5+Math.random()*8)+'px';
    confetti.style.opacity=Math.random()*0.9+0.1;
    confetti.style.transform=`rotate(${Math.random()*360}deg)`;
    confettiContainer.appendChild(confetti);
    const fallDuration = 3000 + Math.random()*2000;
    confetti.animate([{transform: confetti.style.transform+' translateY(0)',opacity:1},{transform: confetti.style.transform+` translateY(${window.innerHeight+20}px)`,opacity:0}],{duration:fallDuration,easing:'ease-out',fill:'forwards'});
    setTimeout(()=>{confetti.remove();},fallDuration);
  }
}

answerEl.addEventListener('keydown',(e)=>{
  if(e.key==='Enter'){
    clearTimeout(feedbackTimeout);
    const userAnswer=parseInt(answerEl.value);
    if(userAnswer===correctAnswer){
      feedbackEl.textContent='✅ Correct!';
      feedbackEl.className='feedback correct';
      score++;
      beat.playbackRate=1;
      document.body.classList.remove('flash-wrong');
      document.body.classList.add('flash-correct');
      correctSound.currentTime=0; correctSound.play();
      scoreEl.textContent=`Score: ${score}`;
      if(score%10===0){
        const msg=messages[(score/10-1)%messages.length];
        feedbackEl.textContent=`✅ Correct! ${msg}`;
      }
      if(score===50){
        celebrationSound.currentTime=0; celebrationSound.play();
        for(let i=0;i<3;i++){
          setTimeout(()=>celebrateConfetti(200), i*700);
        }
        celebrationText.style.display='block';
        setTimeout(()=>{celebrationText.style.display='none';},3500);
      }
      feedbackTimeout=setTimeout(()=>{
        document.body.classList.remove('flash-correct');
        generateQuestion();
      },1500);
    }else{
      feedbackEl.textContent=`❌ Wrong (Ans: ${correctAnswer})`;
      feedbackEl.className='feedback wrong';
      score=Math.max(0,score-1);
      beat.playbackRate=0.6;
      document.body.classList.remove('flash-correct');
      document.body.classList.add('flash-wrong');
      scoreEl.textContent=`Score: ${score}`;
      feedbackTimeout=setTimeout(()=>{
        document.body.classList.remove('flash-wrong');
        generateQuestion();
      },1500);
    }
  }
});

function startCountdown(seconds,onComplete){
  countdownEl.style.display='block';
  let counter=seconds;
  countdownEl.textContent=counter;
  const interval=setInterval(()=>{
    counter--;
    if(counter>0){countdownEl.textContent=counter;}
    else{
      countdownEl.textContent='Go!';
      clearInterval(interval);
      setTimeout(()=>{countdownEl.style.display='none'; onComplete();},1000);
    }
  },1000);
}

startBtn.addEventListener('click',()=>{
  startBtn.disabled=true; stopBtn.disabled=false;
  beat.play();
  startCountdown(3,()=>{
    startScreen.style.display='none';
    questionEl.style.display='block';
    answerEl.style.display='block';
    scoreEl.style.display='block';
    generateQuestion();
  });
});

stopBtn.addEventListener('click',()=>{beat.pause(); beat.currentTime=0;});
</script>
</body>
</html>

